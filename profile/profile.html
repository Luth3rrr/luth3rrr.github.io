<!DOCTYPE html>
<html>
<head>
  <title>Profile</title>
  <link rel="stylesheet" href="/css/profile.css">
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
</head>
<body>
  <div class="user-profile">
    <img class="user-profile__logo" id="userLogo" src="" alt="User Logo">
  </div>

  <nav class="navbar">
    <ul class="nav-list">
      <li><a class="nav-link active" href="#home">ראשי</a></li>
      <li><a class="nav-link" href="#projects">משחקים</a></li>
      <!-- <li><a class="nav-link" href="#new">משחק החודש</a></li> -->
      <li><a class="nav-link" href="credits.html">קרדיטים</a></li>
      <li><a class="nav-link" href="/stocks.html">בעלי המניות</a></li>
    </ul>
  </nav>

  <h1 id="title">Hello User</h1>
  <p>XP: <span id="xp">0</span></p>
  <p>Level: <span id="level">1</span></p>
  
  <script>
const firebaseConfig = {
  apiKey: "AIzaSyDz0obDDy51SeY6RHcHGPrGAi0Ol1-8VBE",
  authDomain: "mugi-2023.firebaseapp.com",
  databaseURL: "https://mugi-2023-default-rtdb.firebaseio.com",
  projectId: "mugi-2023",
  storageBucket: "mugi-2023.appspot.com",
  messagingSenderId: "257017906410",
  appId: "1:257017906410:web:38bb7865692242b3628393",
  measurementId: "G-8HSQ31CXBF"
};
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in, update the title with user's name
        document.getElementById("title").innerText = "שלום " + user.displayName;

        // Display user logo
        document.getElementById("userLogo").src = user.photoURL;

        // Get a reference to the Firestore database
        const db = firebase.firestore();
        const userRef = db.collection("users").doc(user.uid);

        // Retrieve the user's XP and level from Firestore
        userRef.get()
          .then((doc) => {
            if (doc.exists) {
              const userXP = doc.data().xp || 0;
              const userLevel = doc.data().level || 1;

              // Update the XP and level elements on the profile page
              document.getElementById("xp").innerText = userXP;
              document.getElementById("level").innerText = userLevel;
            } else {
              console.error("User document not found!");
            }
          })
          .catch((error) => {
            console.error("Error getting user document: ", error);
          });
      } else {
        // User is not signed in, redirect to signin.html
        window.location.href = "signin.html";
      }
    });
  </script>
  <script src="/js/app.js"></script>
</body>
</html>
